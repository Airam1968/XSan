*********************************************************************
* Sistema     : Gest∆o de Financiamentos
* Copyright   : Airam Miranda de Almeida
* Programador : Airam Miranda de Almeida
*********************************************************************
* Programa    : CAPT_COB.PRG
* Data        : 01/01/1999
* Objetivo    : Captura dos Dados de Pagamento
* PRG"s       : ---
* DBF"s       : ---
* Alteracao   :
*********************************************************************
FUNCTION CAPT_COB()
SAVE SCREEN TO TELA05
PTIT( "CAPTURA DOS DADOS COBRANÄA BANCµRIA")
SELE 1
USE BANCOS INDEX BANCOS
GOTO TOP
PLIMPA()
SET COLOR TO W/N,+W/R
eCOD_BANCO = 0
@ 05,02 SAY "Banco   : "
GO TOP
DECLARE CAMPO[2],PIC[2],CAB[2],LENS[2]
AFIELDS(CAMPO,.T.,LENS)
PIC[1]="@R9999"
PIC[2]="@S50"
CAB[1]="    "
CAB[2]="    "
DBEDIT(5,15,5,75,CAMPO,"F_CONF_COB",PIC,CAB," "," - "," ")
eDRIVE     = DRIVE
eSUBDIR    = SUBDIR_RET
eDIR       = ALLTRIM(eDRIVE)+":"+ALLTRIM(eSUBDIR)
eCORI_RET  = CORI_RET
eCOD_BANCO = COD_BANCO
SET EXCLUSIVE ON
DO CASE
   CASE eCOD_BANCO = 1
      SELE 2
      USE TRANS001
      GOTO TOP
   CASE eCOD_BANCO = 8
      SELE 2
      USE TRANS008
      GOTO TOP
   CASE eCOD_BANCO = 33
      SELE 2
      USE TRANS033
      GOTO TOP
   CASE eCOD_BANCO = 104
      SELE 2
      USE TRANS104
      GOTO TOP
   CASE eCOD_BANCO = 215
      SELE 2
      USE TRANS215
      GOTO TOP
   CASE eCOD_BANCO = 230
      SELE 2
      USE TRANS230
      GOTO TOP
   CASE eCOD_BANCO = 237
      SELE 2
      USE TRANS237
      GOTO TOP
   CASE eCOD_BANCO = 275
      SELE 2
      USE TRANS275
      GOTO TOP
   CASE eCOD_BANCO = 291
      SELE 2
      USE TRANS291
      GOTO TOP
   CASE eCOD_BANCO = 341
      SELE 2
      USE TRANS341
      GOTO TOP
   CASE eCOD_BANCO = 422
      SELE 2
      USE TRANS422
      GOTO TOP
   CASE eCOD_BANCO = 424
      SELE 2
      USE TRANS424
      GOTO TOP
  CASE eCOD_BANCO = 641
      SELE 2
      USE TRANS641
      GOTO TOP
   OTHERWISE
      SELE 2
      USE TRANSTXT
      GOTO TOP
ENDCASE
SET EXCLUSIVE OFF
SELE 3
USE STATUS
GOTO TOP
eCGC_EMPR = INT(VAL(CGC_CPF))
SELE 1
PLQUA("01")
PPERG ( "Confirma (S/N) ? ")
IF sisRESP = "S"
   @ 07,00 SAY "Data Configuraá∆o : " GET DATA
   @ 09,00 SAY "Drive de Dados    : " GET DRIVE PICT "@! X"
   @ 11,00 SAY "SubDiret¢rio      : " GET SUBDIR_RET
   CLEAR GETS
   PLQUA("01")
   PPERG ( "Deseja Capturar o Arquivo (S/N) ? ")
   IF sisRESP = "S"
      PLQUA("01")
      PMENSAG("Aguarde a Captura dos Arquivos Dispon°veis ...")
      DO WHILE .T.
	 * Box de escolha do arquivo
         eDIR = ALLTRIM(ALLTRIM(eDRIVE)+":"+ALLTRIM(eSUBDIR)+"*."+ALLTRIM(eCORI_RET))
         @ 11,00                                                  
	 @ 11,00 SAY "SubDiret¢rio      : " GET eDIR
	 ARQ_TXT = ADIR(eDIR)
	 eOPCAO  = ARQ_TXT
	 DECLARE vARQUIVO[ARQ_TXT]
	 ADIR(eDIR,vARQUIVO)
	 ASORT(vARQUIVO)
	 SAVE SCREEN TO TELA06
	 @ 12,25 CLEAR TO 21,40
	 @ 12,25 TO 21,40 DOUBLE
	 DO WHILE .T.
	    @ 13,05 SAY "Arquivo Retorno   : " 
	    *MENU_ARQ = ACHOICE(13,27,20,39,vARQUIVO,eOPCAO)	    
	    MENU_ARQ = ACHOICE(13,27,20,39,vARQUIVO)
	    DO CASE
	       CASE LASTKEY() == 13
		  eNOME_ARQ = vARQUIVO[MENU_ARQ]
		  EXIT
	    ENDCASE
	 ENDDO
	 RESTORE SCREEN FROM TELA06
	 @ 14,00 SAY "Arquivo Cobranáa  : " GET eNOME_ARQ 
	 CLEAR GETS
	 SELE 1
	 IF F_BLOQR()
	    REPLACE NOME_ARQ WITH eNOME_ARQ
	    UNLOCK
	 ENDIF
	 PLQUA("01") 
	 PPERG ( "Deseja Pesquisa para outro CGC que n∆o o da Empresa (S/N) ? ")
	 READ
	 IF sisRESP = "S" 
	    PLQUA("01") 
	    @ 23,00 SAY "Altere o CNPJ : " GET eCGC_EMPR PICT "99999999999999" 
	    READ
	 ENDIF   
	 EXIT
      ENDDO  
   ENDIF
   * Transferencia para arquivo DBF
   PLQUA("01")
   PMENSAG("Aguarde a Preparaá∆o do Arquivo ...")
   SELE 2
   GOTO TOP
   IF F_BLOQA()
      PLQUA("01")
      PPERG ( "Deseja Carregar o Arquivo (S/N) ? ")
      IF sisRESP = "S"
	 SELE 1
	 eNOME_ARQ = ALLTRIM(NOME_ARQ)
	 SELE 2
	 DELETE ALL
	 PACK
	 GOTO TOP
	 vARQUIVO = ALLTRIM(eDRIVE)+":"+ALLTRIM(eSUBDIR)+ALLTRIM(eNOME_ARQ)
	 APPEND FROM &vARQUIVO SDF
	 GOTO TOP
      ENDIF
      GOTO TOP
      DELE ALL FOR CGCE_TRN01 <> eCGC_EMPR
      PACK
      DO CASE
         CASE eCOD_BANCO = 1
            REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
                        VIOF_TRN01 WITH VIOF_TRN01/100,;
                        VABA_TRN01 WITH VABA_TRN01/100
            REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
                        VPRI_TRN01 WITH VPRI_TRN01/100,;
                        JMMU_TRN01 WITH JMMU_TRN01/100
            REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100
         CASE eCOD_BANCO = 8
            REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
                        VIOF_TRN01 WITH VIOF_TRN01/100,;
                        VABA_TRN01 WITH VABA_TRN01/100
            REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
                        VPRI_TRN01 WITH VPRI_TRN01/100,;
                        JMMU_TRN01 WITH JMMU_TRN01/100
            REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
                        TACO_TRN01 WITH TACO_TRN01/100
	 CASE eCOD_BANCO = 33
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
	    REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
			TACO_TRN01 WITH TACO_TRN01/100
	 CASE eCOD_BANCO = 104
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
	    REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
			TACO_TRN01 WITH TACO_TRN01/100
         CASE eCOD_BANCO = 215
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
	    REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
			TACO_TRN01 WITH TACO_TRN01/100
         CASE eCOD_BANCO = 237
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
	    REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
			TACO_TRN01 WITH TACO_TRN01/100
	 CASE eCOD_BANCO = 230
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
	    REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
			TACO_TRN01 WITH TACO_TRN01/100
         CASE eCOD_BANCO = 275
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
            REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100
         CASE eCOD_BANCO = 291
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
	    REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
			VOSA_TRN01 WITH VOSA_TRN01/100,;
			TACO_TRN01 WITH TACO_TRN01/100
	 CASE eCOD_BANCO = 341
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
	    REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
			VOSA_TRN01 WITH VOSA_TRN01/100,;
			TACO_TRN01 WITH TACO_TRN01/100
         CASE eCOD_BANCO = 422
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
	    REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
			TACO_TRN01 WITH TACO_TRN01/100
         CASE eCOD_BANCO = 424
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
	    REPLACE ALL OUCR_TRN01 WITH OUCR_TRN01/100,;
			VOSA_TRN01 WITH VOSA_TRN01/100,;
			TACO_TRN01 WITH TACO_TRN01/100
         CASE eCOD_BANCO = 641
	    REPLACE ALL VLTI_TRN01 WITH VLTI_TRN01/100,;
			VIOF_TRN01 WITH VIOF_TRN01/100,;
			VABA_TRN01 WITH VABA_TRN01/100
	    REPLACE ALL VDES_TRN01 WITH VDES_TRN01/100,;
			VPRI_TRN01 WITH VPRI_TRN01/100,;
			JMMU_TRN01 WITH JMMU_TRN01/100
            REPLACE ALL TACO_TRN01 WITH TACO_TRN01/100
      ENDCASE
      UNLOCK
   ENDIF
   PLQUA("01")
   PMSGR( "Captura Conclu°da !",3)
ENDIF
CLOSE ALL
RESTORE SCREEN FROM TELA05
RETURN nil
*************************  fim  *********************************
